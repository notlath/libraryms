{% extends "base.html" %} {% block content %}
<h2>Circulation Management</h2>

<h3>Borrow Book</h3>
<form method="POST" action="{{ url_for('borrow_book') }}" class="mb-4">
  <div class="row">
    <div class="col-md-5">
      <select class="form-select" name="book_id" required>
        <option value="">Select a Book</option>
        {% for book_id, book in books.items() %} {% if book.available > 0 %}
        <option value="{{ book_id }}">
          {{ book.title }} by {{ book.author }} ({{ book.available }} available)
        </option>
        {% endif %} {% endfor %}
      </select>
    </div>
    <div class="col-md-5">
      <select class="form-select" name="borrower_id" required>
        <option value="">Select a Borrower</option>
        {% for borrower_id, borrower in borrowers.items() %}
        <option value="{{ borrower_id }}">
          {{ borrower.name }} ({{ borrower_id }})
        </option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-2">
      <button type="submit" class="btn btn-primary">Borrow</button>
    </div>
  </div>
</form>

<h3>Active Transactions</h3>
<table class="table table-striped">
  <thead>
    <tr>
      <th>Transaction ID</th>
      <th>Book</th>
      <th>Borrower</th>
      <th>Borrow Date</th>
      <th>Due Date</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for transaction in transactions %}
    <tr>
      <td>{{ transaction.id }}</td>
      <td>{{ books[transaction.book_id].title }}</td>
      <td>{{ borrowers[transaction.borrower_id].name }}</td>
      <td>{{ transaction.borrow_date[:10] }}</td>
      <td>{{ transaction.due_date[:10] }}</td>
      <td>
        <a
          href="{{ url_for('return_book', transaction_id=transaction.id) }}"
          class="btn btn-sm btn-success"
          >Return</a
        >
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
